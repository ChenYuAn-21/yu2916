<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>æ ¡åœ’å¾ªç’°ç«™</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    
<nav style="display:flex; align-items:center; justify-content:space-between; gap:12px;">
    <div style="display:flex; align-items:center; gap:12px;">
        
        <a href="{{ url_for('index') }}"><h2 style="margin:0; font-size:1.5rem;">æ ¡åœ’å¾ªç’°ç«™ â€” äºŒæ‰‹ç‰©äº¤æµå¹³å°</h2></a>
        {% if session.get('user_id') %}
            <a class="btn btn-alt" href="{{ url_for('upload') }}">ğŸ“· ä¸Šå‚³äºŒæ‰‹ç‰©å“</a>
        {% else %}
            <a class="btn btn-alt" href="{{ url_for('login') }}">ğŸ“· ä¸Šå‚³äºŒæ‰‹ç‰©å“ï¼ˆéœ€ç™»å…¥ï¼‰</a>
        {% endif %}
    </div>

    <!-- å¸³è™Ÿç³»çµ±é€£çµï¼ˆå³å´ï¼‰ -->
    <div style="display:flex; align-items:center; gap:12px;">
        {% if session.get('user_id') %}
            <a href="{{ url_for('seller_center') }}">ğŸ§‘â€ğŸ« è³£å®¶ä¸­å¿ƒ</a>
            <a href="{{ url_for('orders') }}">ğŸ“¦ è³¼è²·æ¸…å–®</a>
            <a href="{{ url_for('view_cart') }}">ğŸ›’ è³¼ç‰©è»Š (<strong>{{ cart_distinct_count or 0 }}</strong>)</a>
            <a id="convLink" href="{{ url_for('conversations_list') }}">ğŸ’¬ ç§è¨Š <span id="unreadConvBadge" style="display:inline-block; margin-left:4px;">{% if unread_conv_count and unread_conv_count > 0 %} (<strong>{{ unread_conv_count }}</strong>) {% else %}{% endif %}</span></a>
            <span style="margin-left:8px">ç›®å‰ï¼š{{ session.get('user_name') }} (ID: {{ session.get('user_id') }})</span>
            <a href="{{ url_for('logout') }}" style="margin-left:8px">ç™»å‡º</a>
        {% else %}
            <a href="{{ url_for('login') }}">ç™»å…¥</a>
            <a href="{{ url_for('register') }}">è¨»å†Š</a>
        {% endif %}
    </div>
</nav>
<hr>
{% block content %}{% endblock %}
{% if session.get('user_id') %}
<script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
<script>
    // æ›´æ–°æœªè®€æœƒè©±æ•¸ badge çš„ç°¡å–® socket è†è½å™¨
    try{
        const _sock = io();
        _sock.on('unread_conversations', function(d){
            try{
                const el = document.getElementById('unreadConvBadge');
                if(!el) return;
                if(d && d.count && d.count > 0){
                    el.innerHTML = '<strong>' + d.count + '</strong>';
                } else {
                    el.innerHTML = '';
                }
            }catch(e){ console.error('update unread badge error', e); }
        });
    }catch(e){ console.error('socket load error', e); }
</script>
{% endif %}
</body>
</html>
