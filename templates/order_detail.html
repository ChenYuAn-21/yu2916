{% extends 'base.html' %}
{% block content %}
<h2>è¨‚å–®è©³æƒ… - #{{ order.id }}</h2>
<div>
    <strong>è²·å®¶ï¼š</strong> {{ buyer_name or 'åŒ¿å' }} {% if buyer_id %}(ID: {{ buyer_id }}){% endif %}<br>
    <strong>è²·å®¶å§“æ°ï¼š</strong> {{ buyer_surname or 'åŒ¿å' }}<br>
    <strong>è¯çµ¡é›»è©±ï¼š</strong> {{ order.contact_phone or 'ç„¡' }}<br>
    <strong>å–è²¨æ–¹å¼ï¼š</strong> {{ order.delivery_method or 'æœªæŒ‡å®š' }}<br>
    {% if order.shipping_address %}
    <strong>å¯„é€åœ°å€ï¼š</strong> <div style="white-space:pre-wrap;">{{ order.shipping_address }}</div>
    {% endif %}
    <strong>ä¸‹å–®æ™‚é–“ï¼š</strong> {{ order.created_at.strftime('%Y-%m-%d %H:%M') if order.created_at else '' }}
</div>
<div style="margin-top:10px;">
    {% if buyer_id %}
        {% if items and items|length > 0 %}
            <a class="btn btn-alt" href="{{ url_for('conversations_start', seller_id=buyer_id, item_id=items[0][1].id) }}">ğŸ’¬ è¯çµ¡è²·å®¶ï¼ˆç§è¨Šï¼‰</a>
        {% else %}
            <a class="btn btn-alt" href="{{ url_for('conversations_start', seller_id=buyer_id) }}">ğŸ’¬ è¯çµ¡è²·å®¶ï¼ˆç§è¨Šï¼‰</a>
        {% endif %}
    {% else %}
        <button id="showContactBtn" class="btn btn-alt">ğŸ“ é¡¯ç¤ºè¯çµ¡è³‡è¨Š</button>
    {% endif %}

    <div id="contactInfo" style="display:none; margin-top:8px; background:#f9f9f9; padding:8px; border-radius:6px;">
        <div><strong>è¯çµ¡é›»è©±ï¼š</strong> {{ order.contact_phone or 'ç„¡' }}</div>
        {% if order.shipping_address %}
        <div style="margin-top:6px;"><strong>å¯„é€åœ°å€ï¼š</strong><div style="white-space:pre-wrap;">{{ order.shipping_address }}</div></div>
        {% endif %}
        <div style="margin-top:6px; color:#666;">æ­¤è²·å®¶ç‚ºåŒ¿åä½¿ç”¨è€…ï¼Œç„¡æ³•é€éç«™å…§ç§è¨Šï¼Œè«‹ä½¿ç”¨ä¸Šæ–¹é›»è©±æˆ–åœ°å€è¯çµ¡ã€‚</div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function(){
    var btn = document.getElementById('showContactBtn');
    if(btn){
        btn.addEventListener('click', function(){
            var info = document.getElementById('contactInfo');
            if(!info) return;
            info.style.display = (info.style.display === 'none') ? 'block' : 'none';
            btn.textContent = (info.style.display === 'block') ? 'æ”¶èµ·è¯çµ¡è³‡è¨Š' : 'ğŸ“ é¡¯ç¤ºè¯çµ¡è³‡è¨Š';
        });
    }
});
</script>
<h3 style="margin-top:12px;">è¨‚å–®é …ç›®</h3>
<table border="1" cellpadding="6" cellspacing="0" style="border-collapse:collapse; width:100%;">
<thead><tr><th>å•†å“ID</th><th>åç¨±</th><th>åƒ¹æ ¼</th><th>æ•¸é‡</th></tr></thead>
<tbody>
{% for oi, item in items %}
    <tr>
        <td>{{ oi.item_id }}</td>
        <td><a href="{{ url_for('item_detail', item_id=item.id) }}">{{ item.name }}</a></td>
        <td>{{ oi.price }}</td>
        <td>{{ oi.quantity }}</td>
    </tr>
{% else %}
    <tr><td colspan="4">ç„¡è¨‚å–®é …ç›®</td></tr>
{% endfor %}
 </tbody>
</table>
{% endblock %}
